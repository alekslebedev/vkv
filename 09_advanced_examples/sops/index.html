<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>encrypt & decrypt using sops - vkv</title>
<meta name=description content="the swiss army knife when working with Vault KVv2 engines">
<meta name=generator content="Hugo 0.92.2">
<link href=https://falcosuessgott.github.io/vkv//index.xml rel=alternate type=application/rss+xml>
<link rel=canonical href=https://falcosuessgott.github.io/vkv/09_advanced_examples/sops/>
<link rel=stylesheet href=https://falcosuessgott.github.io/vkv/css/theme.min.css>
<link rel=stylesheet href=https://falcosuessgott.github.io/vkv/css/chroma.min.css>
<script defer src=https://falcosuessgott.github.io/vkv//js/fontawesome6/all.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js integrity="sha256-H3cjtrm/ztDeuhCN9I4yh4iN2Ybx/y1RM7rMmAesA0k=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js integrity="sha256-4XodgW4TwIJuDtf+v6vDJ39FVxI0veC/kSCCmnFp7ck=" crossorigin=anonymous></script>
<script src=https://falcosuessgott.github.io/vkv/js/bundle.js></script><style>:root{}</style>
<meta property="og:title" content="encrypt & decrypt using sops">
<meta property="og:description" content="In order to store the secret export created by vkv sops can be used. This example shows how to encrypt & decrypt vkv exported secrets using sops and Vaults transit engine:
Prerequisites  Install sops  Demo export VAULT_ADDR=&#34;https://vault.server&#34; export VAULT_TOKEN=&#34;hvs.XXXX&#34; # enable engine and create encryption key vault secrets enable -path=sops transit vault write sops/keys/vkv type=rsa-4096 # export secrets as yaml and write to file vkv export -p secret --show-values -f=yaml > export.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://falcosuessgott.github.io/vkv/09_advanced_examples/sops/"><meta property="og:image" content="https://falcosuessgott.github.io/vkv/images/og-image.png"><meta property="article:section" content="09_advanced_examples">
<meta property="og:site_name" content="Hugo Techdoc Theme">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://falcosuessgott.github.io/vkv/images/og-image.png">
<meta name=twitter:title content="encrypt & decrypt using sops">
<meta name=twitter:description content="In order to store the secret export created by vkv sops can be used. This example shows how to encrypt & decrypt vkv exported secrets using sops and Vaults transit engine:
Prerequisites  Install sops  Demo export VAULT_ADDR=&#34;https://vault.server&#34; export VAULT_TOKEN=&#34;hvs.XXXX&#34; # enable engine and create encryption key vault secrets enable -path=sops transit vault write sops/keys/vkv type=rsa-4096 # export secrets as yaml and write to file vkv export -p secret --show-values -f=yaml > export.">
<meta itemprop=name content="encrypt & decrypt using sops">
<meta itemprop=description content="In order to store the secret export created by vkv sops can be used. This example shows how to encrypt & decrypt vkv exported secrets using sops and Vaults transit engine:
Prerequisites  Install sops  Demo export VAULT_ADDR=&#34;https://vault.server&#34; export VAULT_TOKEN=&#34;hvs.XXXX&#34; # enable engine and create encryption key vault secrets enable -path=sops transit vault write sops/keys/vkv type=rsa-4096 # export secrets as yaml and write to file vkv export -p secret --show-values -f=yaml > export.">
<meta itemprop=wordCount content="161"><meta itemprop=image content="https://falcosuessgott.github.io/vkv/images/og-image.png">
<meta itemprop=keywords content></head>
<body><div class=container><header>
<h1>vkv</h1><span class=version>Version v0.2.2</span><a href=https://github.com/FalcoSuessgott/vkv class=github><i class="fab fa-github"></i></a>
<p class=description>the swiss army knife when working with Vault KVv2 engines</p>
</header>
<div class=global-menu>
<nav>
<ul>
<li id=home><a href=/vkv/></a></li></ul>
</nav>
</div>
<div class=content-container>
<main><h1>encrypt & decrypt using sops</h1>
<p>In order to store the secret export created by <code>vkv</code> <a href=https://github.com/mozilla/sops#encrypting-using-hashicorp-vault>sops</a> can be used.
This example shows how to encrypt & decrypt <code>vkv</code> exported secrets using <code>sops</code> and Vaults transit engine:</p>
<h3 id=prerequisites>Prerequisites</h3>
<ul>
<li>Install <a href=https://github.com/mozilla/sops/releases>sops</a></li>
</ul>
<h3 id=demo>Demo</h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>export VAULT_ADDR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://vault.server&#34;</span>
export VAULT_TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;hvs.XXXX&#34;</span>

<span style=color:#75715e># enable engine and create encryption key</span>
vault secrets enable -path<span style=color:#f92672>=</span>sops transit
vault write sops/keys/vkv type<span style=color:#f92672>=</span>rsa-4096

<span style=color:#75715e># export secrets as yaml and write to file</span>
vkv export -p secret --show-values -f<span style=color:#f92672>=</span>yaml &gt; export.yaml

<span style=color:#75715e># configure sops</span>
cat <span style=color:#e6db74>&lt;&lt;EOF &gt; .sops.yaml
</span><span style=color:#e6db74>creation_rules:
</span><span style=color:#e6db74>        - path_regex: \.yaml$
</span><span style=color:#e6db74>          hc_vault_transit_uri: &#34;http://$VAULT_ADDR/v1/sops/keys/vkv&#34;
</span><span style=color:#e6db74>EOF</span>

<span style=color:#75715e># encrypt secrets</span>
sops -e export.yaml &gt; encrypted_export.yaml

<span style=color:#75715e># decrypt secrets</span>
sops -d encrypted_export.yaml
</code></pre></div><p>an encrypted secrets file looks like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>secret/</span>:
    <span style=color:#f92672>admin</span>:
        <span style=color:#f92672>sub</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:fmHQMHCBNIs=,iv:s2q/j2tYvTN+u8KOXKm+Rbt1Y3oFO0fwjYCQy3jBHEU=,tag:+f5t/2LZCkIaAaoYeiY9KA==,type:str]</span>
    <span style=color:#f92672>demo</span>:
        <span style=color:#f92672>foo</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:kZwT,iv:QkNZwsUZ4lngluUHXae7abYAjAZFbNgJ7GdgM18GlLM=,tag:74aMFxt1pmCCy/rFcD7/rw==,type:str]</span>
    <span style=color:#f92672>sub/</span>:
        <span style=color:#f92672>demo</span>:
            <span style=color:#f92672>demo</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:f1m2veKk4w7i2hc=,iv:PyycH5Z9TEf/9u/nm7XYcnMEBHB+AY4ARAABoV8DQ74=,tag:QsPcwlw3vQNxytrfiZ1lyg==,type:str]</span>
            <span style=color:#f92672>password</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:m6DXfI4r,iv:3rLoWDTRfHuGUzJjoOemYv4C89EedK+CKX+9R7QfDZI=,tag:2Ul1wt77XGzina8QyOZMjQ==,type:str]</span>
            <span style=color:#f92672>user</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:EYXYIU8=,iv:7ll05h50Nu0Mp+bWuIrJjEsP4KRpH8L1vn3ZvqXlEPc=,tag:zN8Pzmk4QvX1hdlb955KaQ==,type:str]</span>
        <span style=color:#f92672>sub2/</span>:
            <span style=color:#f92672>demo</span>:
                <span style=color:#f92672>foo</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:AnMP,iv:oyaYacdlcnInw57im4ARprWz6wkgKqguiK6IHwdwn4w=,tag:4u0JZJ1jFvevZLDe/tlmzg==,type:str]</span>
                <span style=color:#f92672>password</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:Q1zzktiD58Q=,iv:1OZjqPyW0MNiTcll3tXkZ4AQ9CnNqtWzYmSw6PPEYxo=,tag:Z29GfxZnrWJnnzI8dckNHw==,type:str]</span>
                <span style=color:#f92672>user</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:a4Ju3Q==,iv:lpMo+/5K3mwqLQSpoAKLaL/Np6KAtoJDFZEAslu6TOY=,tag:BiZ4t7muKQu+AU9JvTNc4w==,type:str]</span>
<span style=color:#f92672>sops</span>:
    <span style=color:#f92672>kms</span>: []
    <span style=color:#f92672>gcp_kms</span>: []
    <span style=color:#f92672>azure_kv</span>: []
    <span style=color:#f92672>hc_vault</span>:
        - <span style=color:#f92672>vault_address</span>: <span style=color:#ae81ff>http://127.0.0.1:8200</span>
          <span style=color:#f92672>engine_path</span>: <span style=color:#ae81ff>sops</span>
          <span style=color:#f92672>key_name</span>: <span style=color:#ae81ff>vkv</span>
          <span style=color:#f92672>created_at</span>: <span style=color:#e6db74>&#34;2022-11-17T14:23:40Z&#34;</span>
          <span style=color:#f92672>enc</span>: <span style=color:#ae81ff>vault:v1:LtnJjUYl/pBDSOQrhSIsLp6XW0Ng/TM26GjBYcy95Fn8qAXBqJRyhYUd9Df5HF91RIhpiV11Rgj9hKj4sg0HcZIQnuBTQo30mgVQGcUhIL2PrV1qgDB3Ezm0W90s4aKH/8fhvToGVPB5nhf2/z9hTwnmFO+39GnC1JooofRdo9+1B7DBcsvliWSc4gIu3EbJwYUTqxLu92BJYWYM5ZZNtox0snJiYK3dfI7tltD7AtCYmwSJXFlkN3/lUrBGcNFOpya00/dKR/it2qbgtIJclcqPsYx6zoJ0MG/Z1RIs+v5mQjQlDKP2Stqxj+MijwtoPeXtdhdt7wdbWTxQHe4euw==</span>
    <span style=color:#f92672>age</span>: []
    <span style=color:#f92672>lastmodified</span>: <span style=color:#e6db74>&#34;2022-11-17T14:23:40Z&#34;</span>
    <span style=color:#f92672>mac</span>: <span style=color:#ae81ff>ENC[AES256_GCM,data:X+yzr/+S6KWYaMrb1rvDK8bS5ghXDrnSzIT0RZ1TJdXzhcJmvxyUo2rfWkTVzNKcmoJnWyPKRujGVKZWTVmqa5hC5PQbc6tOqRgNrUmo4YkUoOyCyvPhJqCrRrjrhRtrUPIvRcDWMIhZCibjlr+XSglb+lkgVWNcghLWnez9I/w=,iv:2dZUWjnsLOLHV7wfFbIBDSW3ehLtsxmNeqmMwDsDqwU=,tag:PpaLsAA25TWQnYNTQnDswQ==,type:str]</span>
    <span style=color:#f92672>pgp</span>: []
    <span style=color:#f92672>unencrypted_suffix</span>: <span style=color:#ae81ff>_unencrypted</span>
    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>3.7.3</span>
</code></pre></div><div class=edit-meta>
<br><a href=https://github.com/FalcoSuessgott/vkv/edit/master/www/content/09_advanced_examples/sops.md class=edit-page><i class="fas fa-pen-square"></i>&nbsp;Edit on GitHub</a></div><nav class=pagination><a class="nav nav-prev" href=https://falcosuessgott.github.io/vkv/09_advanced_examples/fzf/ title="browse all KVv2 engines"><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - browse all KVv2 engines</a>
<a class="nav nav-next" href=https://falcosuessgott.github.io/vkv/10_development/ title=Development>Next - Development <i class="fas fa-arrow-right" aria-hidden=true></i></a>
</nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p>
</footer>
</main>
<div class=sidebar>
<nav class=slide-menu>
<ul>
<li><a href=https://falcosuessgott.github.io/vkv/>Home</a></li>
<li><a href=https://falcosuessgott.github.io/vkv/01_quickstart/>Quickstart</a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/02_installation/>Installation</a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/03_authentication/>Authentication</a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/04_configuration/>Configuration</a>
</li>
<li class=has-sub-menu><a href=https://falcosuessgott.github.io/vkv/05_export/>vkv export<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://falcosuessgott.github.io/vkv/05_export/formats/>output formats</a></li>
</ul>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/06_import/>vkv import </a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/07_01_snapshot_save/>vkv snapshot save</a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/07_02_snapshot_restore/>vkv snapshot restore</a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/08_01_list_namespaces/>vkv list namespaces</a>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/08_02_list_engines/>vkv list engines</a>
</li>
<li class="parent has-sub-menu"><a href=https://falcosuessgott.github.io/vkv/09_advanced_examples/>Advanced examples<span class="mark opened">-</span></a>
<ul class=sub-menu>
<li><a href=https://falcosuessgott.github.io/vkv/09_advanced_examples/diff/>compare KVv2 engines</a></li>
<li><a href=https://falcosuessgott.github.io/vkv/09_advanced_examples/kubernetes/>scheduled vkv snapshots using Kubernetes</a></li>
<li><a href=https://falcosuessgott.github.io/vkv/09_advanced_examples/fzf/>browse all KVv2 engines</a></li>
<li class=active><a href=https://falcosuessgott.github.io/vkv/09_advanced_examples/sops/>encrypt & decrypt using sops</a></li>
</ul>
</li>
<li><a href=https://falcosuessgott.github.io/vkv/10_development/>Development</a>
</li>
</ul>
</nav>
<div class=sidebar-footer></div>
</div>
</div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20>
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>